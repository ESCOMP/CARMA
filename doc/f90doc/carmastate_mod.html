<HTML>
<HEAD>
   <TITLE> module carmastate_mod (generated by f90doc) </TITLE>
</HEAD>
<H1> Module carmastate_mod </H1>
<PRE>module carmastate_mod

        ! Uses
    use <A HREF="carma_precision_mod.html">carma_precision_mod</A>
    use <A HREF="carma_enums_mod.html">carma_enums_mod</A>
    use <A HREF="carma_constants_mod.html">carma_constants_mod</A>
    use <A HREF="carma_types_mod.html">carma_types_mod</A>

        ! Subroutines and functions
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_create">CARMASTATE_Create</A> (cstate, carma_ptr, time, dtime, NZ, igridv, xc, yc, zc, zl, p, pl, t, rc, qh2o, relhum, told, radint)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_createfromreference">CARMASTATE_CreateFromReference</A> (cstate, carma_ptr, time, dtime, NZ, igridv, xc, yc, zc, zl, p, pl, t, rc, qh2o, relhum, qh2so4)
    private subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_allocate">CARMASTATE_Allocate</A> (cstate, rc)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_destroy">CARMASTATE_Destroy</A> (cstate, rc)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_step">CARMASTATE_Step</A> (cstate, rc, cldfrc, rhcrit, lndfv, ocnfv, icefv, lndram, ocnram, iceram, lndfrac, ocnfrac, icefrac)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_get">CARMASTATE_Get</A> (cstate, rc, max_nsubstep, max_nretry, nstep, nsubstep, nretry, zsubsteps, xc, yc)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_getbin">CARMASTATE_GetBin</A> (cstate, ielem, ibin, mmr, rc, nmr, numberDensity, nucleationRate, r_wet, rhop_wet, rhop_dry, surface, sedimentationflux, vf, vd, dtpart, kappa)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_getdetrain">CARMASTATE_GetDetrain</A> (cstate, ielem, ibin, mmr, rc, nmr, numberDensity, r_wet, rhop_wet)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_getgas">CARMASTATE_GetGas</A> (cstate, igas, mmr, rc, satice, satliq, eqice, eqliq, wtpct)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_getstate">CARMASTATE_GetState</A> (cstate, rc, t, p, rhoa_wet, rlheat)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_setbin">CARMASTATE_SetBin</A> (cstate, ielem, ibin, mmr, rc, surface)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_setdetrain">CARMASTATE_SetDetrain</A> (cstate, ielem, ibin, mmr, rc)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_setgas">CARMASTATE_SetGas</A> (cstate, igas, mmr, rc, mmr_old, satice_old, satliq_old)
    public subroutine <A HREF="carmastate_mod.html#subroutine_carmastate_setstate">CARMASTATE_SetState</A> (cstate, rc, t, rhoa_wet)

end module carmastate_mod
</PRE>
 The CARMA state module contains the atmospheric data for use with the CARMA
 module. This implementation has been customized to work within other model
 frameworks. CARMA adds a lot of extra state information (atmospheric
 properties, fall velocities, coagulation kernels, growth kernels, ...) and
 thus has a large memory footprint. Because only one column will be operated
 upon at a time per thread, only one cstate object needs to be instantiated
 at a time and each cstate object only represents one column. This keeps
 the memory requirements of CARMA to a minimum.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen, Pete Colarco, Jamie Smith
<P>
<STRONG>Version:</STRONG> Feb-2009

<HR><H2> Description of Subroutines and Functions </H2>
<A NAME="subroutine_carmastate_create"><H3>CARMASTATE_Create</H3></A>
<PRE>public subroutine CARMASTATE_Create (cstate, carma_ptr, time, dtime, NZ, igridv, xc, yc, zc, zl, p, pl, t, rc, qh2o, relhum, told, radint)
    type (carmastate_type), intent(inout) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    type (carma_type), pointer, intent(in) :: carma_ptr
</PRE>
<DL><DD><DL><DD>
 (in) the carma object
</DL></DL>
<PRE>    real (kind=f), intent(in) :: time
</PRE>
<DL><DD><DL><DD>
 the model time [s]
</DL></DL>
<PRE>    real (kind=f), intent(in) :: dtime
</PRE>
<DL><DD><DL><DD>
 the timestep size [s]
</DL></DL>
<PRE>    integer, intent(in) :: NZ
</PRE>
<DL><DD><DL><DD>
 the number of vertical grid points
</DL></DL>
<PRE>    integer, intent(in) :: igridv
</PRE>
<DL><DD><DL><DD>
 vertical grid type
</DL></DL>
<PRE>    real (kind=f), intent(in) :: xc
</PRE>
<DL><DD><DL><DD>
 x at center
</DL></DL>
<PRE>    real (kind=f), intent(in) :: yc
</PRE>
<DL><DD><DL><DD>
 y at center
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ) :: zc
</PRE>
<DL><DD><DL><DD>
 z at center
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ+1) :: zl
</PRE>
<DL><DD><DL><DD>
 z at edge
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ) :: p
</PRE>
<DL><DD><DL><DD>
 pressure at center [Pa]
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ+1) :: pl
</PRE>
<DL><DD><DL><DD>
 presssure at edge [Pa]
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ) :: t
</PRE>
<DL><DD><DL><DD>
 temperature at center [K]
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code, negative indicates failure
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (NZ) :: qh2o
</PRE>
<DL><DD><DL><DD>
 specific humidity at center [mmr]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (NZ) :: relhum
</PRE>
<DL><DD><DL><DD>
 relative humidity at center [fraction]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (NZ) :: told
</PRE>
<DL><DD><DL><DD>
 previous temperature at center [K]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (NZ,carma_ptr%f_NWAVE) :: radint
</PRE>
<DL><DD><DL><DD>
 radiative intensity [W/m2/sr/cm]
</DL></DL>
<PRE>    ! Calls: <A HREF="CARMASTATE_Allocate.html">CARMASTATE_Allocate</A>, <A HREF="setupatm.html">setupatm</A>, <A HREF="vaporp_h2o_murphy2005.html">vaporp_h2o_murphy2005</A>
end subroutine CARMASTATE_Create
</PRE>
 Create the CARMASTATE object, which contains information about the
 atmospheric state. Internally, CARMA uses CGS units, but this interface uses
 MKS units which are more commonly used in parent models. The units and grid
 orientation depend on the grid type:
<P>
  <UL>
  <LI>  igridv
    <UL>
    <LI>  I_CART   : Cartesian coordinates, units in [m], bottom at NZ=1
    <LI>  I_SIG    : Sigma coordinates, unitless [P/P0], top at NZ=1
    <LI>  I_HYBRID : Hybrid coordinates, unitless [~P/P0], top at NZ=1
<P>
    </UL>
  </UL>
 NOTE: The supplied CARMA object should already have been created, configured,
 and initialized.
<P>
 NOTE: The relative humidity is optional, but needs to be supplied if particles
 are subject to swelling based upon relative humidity. The specific humdity can
 can be specified instead. If both are specified, then the realtive humidity is
 used.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_Create.html">CARMA_Create</A>, module <A HREF="CARMA_Initialize.html">CARMA_Initialize</A>, module <A HREF="CARMASTATE_Destroy.html">CARMASTATE_Destroy</A>
<A NAME="subroutine_carmastate_createfromreference"><H3>CARMASTATE_CreateFromReference</H3></A>
<PRE>public subroutine CARMASTATE_CreateFromReference (cstate, carma_ptr, time, dtime, NZ, igridv, xc, yc, zc, zl, p, pl, t, rc, qh2o, relhum, qh2so4)
    type (carmastate_type), intent(inout) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    type (carma_type), pointer, intent(in) :: carma_ptr
</PRE>
<DL><DD><DL><DD>
 (in) the carma object
</DL></DL>
<PRE>    real (kind=f), intent(in) :: time
</PRE>
<DL><DD><DL><DD>
 the model time [s]
</DL></DL>
<PRE>    real (kind=f), intent(in) :: dtime
</PRE>
<DL><DD><DL><DD>
 the timestep size [s]
</DL></DL>
<PRE>    integer, intent(in) :: NZ
</PRE>
<DL><DD><DL><DD>
 the number of vertical grid points
</DL></DL>
<PRE>    integer, intent(in) :: igridv
</PRE>
<DL><DD><DL><DD>
 vertical grid type
</DL></DL>
<PRE>    real (kind=f), intent(in) :: xc
</PRE>
<DL><DD><DL><DD>
 x at center
</DL></DL>
<PRE>    real (kind=f), intent(in) :: yc
</PRE>
<DL><DD><DL><DD>
 y at center
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ) :: zc
</PRE>
<DL><DD><DL><DD>
 z at center
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ+1) :: zl
</PRE>
<DL><DD><DL><DD>
 z at edge
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ) :: p
</PRE>
<DL><DD><DL><DD>
 pressure at center [Pa]
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ+1) :: pl
</PRE>
<DL><DD><DL><DD>
 presssure at edge [Pa]
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (NZ) :: t
</PRE>
<DL><DD><DL><DD>
 temperature at center [K]
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code, negative indicates failure
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (NZ) :: qh2o
</PRE>
<DL><DD><DL><DD>
 specific humidity at center [mmr]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (NZ) :: relhum
</PRE>
<DL><DD><DL><DD>
 relative humidity at center [fraction]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (NZ) :: qh2so4
</PRE>
<DL><DD><DL><DD>
 H2SO4 mass mixing ratio at center [mmr]
</DL></DL>
<PRE>    ! Calls: <A HREF="CARMASTATE_Allocate.html">CARMASTATE_Allocate</A>, <A HREF="rhopart.html">rhopart</A>, <A HREF="setupatm.html">setupatm</A>, <A HREF="setupbdif.html">setupbdif</A>, <A HREF="setupckern.html">setupckern</A>, <A HREF="setupgkern.html">setupgkern</A>, <A HREF="setupgrow.html">setupgrow</A>, <A HREF="setupnuc.html">setupnuc</A>, <A HREF="setupvf.html">setupvf</A>, <A HREF="supersat.html">supersat</A>, <A HREF="vaporp_h2o_murphy2005.html">vaporp_h2o_murphy2005</A>
end subroutine CARMASTATE_CreateFromReference
</PRE>
 Create the CARMASTATE object, which contains information about the
 atmospheric state.
<P>
 This call is similar to CARMASTATE_Create, but differs in that all the
 initialization happens here based on the the fixed state information provided rather
 than occurring in CARMASTATE_Step.
<P>
 This call should be done before CARMASTATE_Create when do_fixedinit has been
 specified. The temperatures and pressures specified here should be the reference
 state used for all columns, not an actual column from the model.
<P>
 A water vapor profile is optional, but is used whenever  either qh2o (preferred)
 or relhum have been provided. If this is not provided, then initialization will
 be done on a dry profile. If particle swelling occurs, initialization will be
 done on the wet radius; however, most of the initialized values will not get
 recalculated as the wet radius changes.
<P>
 CARMASTATE_Create should still be called again after this call with the actual
 column of state information from the model. The initialization will be done once
 from the reference state, but the microphysical calculations will be done on the
 model state. Multiple CARMASTATE_Create ... CARMASTATE_Step calls can be done
 before a CARMASTATE_Destroy. This reduces the amount of memory allocations and
 when used with do_fixedinit, reduces the amount of time spent initializing.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> June-2010
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_Create.html">CARMA_Create</A>, module <A HREF="CARMA_Initialize.html">CARMA_Initialize</A>, module <A HREF="CARMASTATE_Destroy.html">CARMASTATE_Destroy</A>
<A NAME="subroutine_carmastate_allocate"><H3>CARMASTATE_Allocate</H3></A>
<PRE>private subroutine CARMASTATE_Allocate (cstate, rc)
    type (carmastate_type), intent(inout) :: cstate
    integer, intent(out) :: rc
end subroutine CARMASTATE_Allocate
</PRE>
<A NAME="subroutine_carmastate_destroy"><H3>CARMASTATE_Destroy</H3></A>
<PRE>public subroutine CARMASTATE_Destroy (cstate, rc)
    type (carmastate_type), intent(inout) :: cstate
    integer, intent(out) :: rc
end subroutine CARMASTATE_Destroy
</PRE>
 The routine should be called when the carma state object is no longer needed.
 It deallocates any memory allocations made by CARMA during CARMASTATE_Create(),
 and failure to call this routine could result in memory leaks.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMASTATE_Create.html">CARMASTATE_Create</A>
<A NAME="subroutine_carmastate_step"><H3>CARMASTATE_Step</H3></A>
<PRE>public subroutine CARMASTATE_Step (cstate, rc, cldfrc, rhcrit, lndfv, ocnfv, icefv, lndram, ocnram, iceram, lndfrac, ocnfrac, icefrac)
    type (carmastate_type), intent(inout) :: cstate
    integer, intent(out) :: rc
    real (kind=f), optional, intent(in), dimension (cstate%f_NZ) :: cldfrc
</PRE>
<DL><DD><DL><DD>
 cloud fraction [fraction]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (cstate%f_NZ) :: rhcrit
</PRE>
<DL><DD><DL><DD>
 relative humidity for onset of liquid clouds [fraction]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: lndfv
</PRE>
<DL><DD><DL><DD>
 the surface friction velocity over land  [m/s]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: ocnfv
</PRE>
<DL><DD><DL><DD>
 the surface friction velocity over ocean  [m/s]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: icefv
</PRE>
<DL><DD><DL><DD>
 the surface friction velocity over ice  [m/s]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: lndram
</PRE>
<DL><DD><DL><DD>
 the aerodynamic resistance over land [s/m]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: ocnram
</PRE>
<DL><DD><DL><DD>
 the aerodynamic resistance over ocean [s/m]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: iceram
</PRE>
<DL><DD><DL><DD>
 the aerodynamic resistance over ice [s/m]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: lndfrac
</PRE>
<DL><DD><DL><DD>
 land fraction
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: ocnfrac
</PRE>
<DL><DD><DL><DD>
 ocn fraction
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: icefrac
</PRE>
<DL><DD><DL><DD>
 ice fraction
</DL></DL>
<PRE>    ! Calls: <A HREF="fixcorecol.html">fixcorecol</A>, <A HREF="rhopart.html">rhopart</A>, <A HREF="setupbdif.html">setupbdif</A>, <A HREF="setupckern.html">setupckern</A>, <A HREF="setupgkern.html">setupgkern</A>, <A HREF="setupgrow.html">setupgrow</A>, <A HREF="setupnuc.html">setupnuc</A>, <A HREF="setupvdry.html">setupvdry</A>, <A HREF="setupvf.html">setupvf</A>, <A HREF="step.html">step</A>, <A HREF="supersat.html">supersat</A>
end subroutine CARMASTATE_Step
</PRE>
 The routine performs the main CARMA processing for one timestep of
 the parent model. The state variables should have all been set before
 calling CARMASTATE_Step(). When this routine returns, the state will
 have been updated to reflect the changes from the CARMA microphysics.
 If tendencies are desired, then the difference between the final and
 initial state will need to be computed by the caller.
<P>
 NIOTE: xxxfv, xxxram and xxxfrac need to be specified for dry deposition.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<A NAME="subroutine_carmastate_get"><H3>CARMASTATE_Get</H3></A>
<PRE>public subroutine CARMASTATE_Get (cstate, rc, max_nsubstep, max_nretry, nstep, nsubstep, nretry, zsubsteps, xc, yc)
    type (carmastate_type), intent(in) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code, negative indicates failure
</DL></DL>
<PRE>    integer, optional, intent(out) :: max_nsubstep
</PRE>
<DL><DD><DL><DD>
 maximum number of substeps in a step
</DL></DL>
<PRE>    real (kind=f), optional, intent(out) :: max_nretry
</PRE>
<DL><DD><DL><DD>
 maximum number of retries in a step
</DL></DL>
<PRE>    real (kind=f), optional, intent(out) :: nstep
</PRE>
<DL><DD><DL><DD>
 total number of steps taken
</DL></DL>
<PRE>    integer, optional, intent(out) :: nsubstep
</PRE>
<DL><DD><DL><DD>
 total number of substeps taken
</DL></DL>
<PRE>    real (kind=f), optional, intent(out) :: nretry
</PRE>
<DL><DD><DL><DD>
 total number of retries taken
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: zsubsteps
</PRE>
<DL><DD><DL><DD>
 number of substeps taken per vertical grid point
</DL></DL>
<PRE>    real (kind=f), optional, intent(out) :: xc
</PRE>
<DL><DD><DL><DD>
 x location at center
</DL></DL>
<PRE>    real (kind=f), optional, intent(out) :: yc
</PRE>
<DL><DD><DL><DD>
 y location at center
</DL></DL>
<PRE>end subroutine CARMASTATE_Get
</PRE>
 Gets the mass mixing ratio for the gas (igas). After a call to CARMA_Step(),
 the new mass mixing ratio of the gas can be retrieved.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_AddGas.html">CARMA_AddGas</A>, module <A HREF="CARMA_GetGas.html">CARMA_GetGas</A>, module <A HREF="CARMA_Step.html">CARMA_Step</A>, module <A HREF="CARMASTATE_SetGas.html">CARMASTATE_SetGas</A>
<A NAME="subroutine_carmastate_getbin"><H3>CARMASTATE_GetBin</H3></A>
<PRE>public subroutine CARMASTATE_GetBin (cstate, ielem, ibin, mmr, rc, nmr, numberDensity, nucleationRate, r_wet, rhop_wet, rhop_dry, surface, sedimentationflux, vf, vd, dtpart, kappa)
    type (carmastate_type), intent(in) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    integer, intent(in) :: ielem
</PRE>
<DL><DD><DL><DD>
 the element index
</DL></DL>
<PRE>    integer, intent(in) :: ibin
</PRE>
<DL><DD><DL><DD>
 the bin index
</DL></DL>
<PRE>    real (kind=f), intent(out), dimension (cstate%f_NZ) :: mmr
</PRE>
<DL><DD><DL><DD>
 the bin mass mixing ratio [kg/kg]
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code negative indicates failure
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: nmr
</PRE>
<DL><DD><DL><DD>
 number mixing ratio [#/kg]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: numberDensity
</PRE>
<DL><DD><DL><DD>
 number density [#/cm3]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: nucleationRate
</PRE>
<DL><DD><DL><DD>
 nucleation rate [1/cm3/s]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: r_wet
</PRE>
<DL><DD><DL><DD>
 wet particle radius [cm]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: rhop_wet
</PRE>
<DL><DD><DL><DD>
 wet particle density [g/cm3]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: rhop_dry
</PRE>
<DL><DD><DL><DD>
 dry particle density [g/cm3]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out) :: surface
</PRE>
<DL><DD><DL><DD>
 particle mass on the surface [kg/m2]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out) :: sedimentationflux
</PRE>
<DL><DD><DL><DD>
 particle sedimentation mass flux to surface [kg/m2/s]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ+1) :: vf
</PRE>
<DL><DD><DL><DD>
 fall velocity [cm/s]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out) :: vd
</PRE>
<DL><DD><DL><DD>
 deposition velocity [cm/s]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: dtpart
</PRE>
<DL><DD><DL><DD>
 delta particle temperature [K]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: kappa
</PRE>
<DL><DD><DL><DD>
 hygroscopicity parameter
</DL></DL>
<PRE>end subroutine CARMASTATE_GetBin
</PRE>
 Gets the mass of the bins (ibin) for each particle element (ielem). After the
 CARMA_Step() call, new particle concentrations are determined. The number density
 and the nucleation rate are only calculated if the element is the number density
 element for the group.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_AddElement.html">CARMA_AddElement</A>, module <A HREF="CARMA_AddGroup.html">CARMA_AddGroup</A>, module <A HREF="CARMA_Step.html">CARMA_Step</A>, module <A HREF="CARMASTATE_SetBin.html">CARMASTATE_SetBin</A>
<A NAME="subroutine_carmastate_getdetrain"><H3>CARMASTATE_GetDetrain</H3></A>
<PRE>public subroutine CARMASTATE_GetDetrain (cstate, ielem, ibin, mmr, rc, nmr, numberDensity, r_wet, rhop_wet)
    type (carmastate_type), intent(in) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    integer, intent(in) :: ielem
</PRE>
<DL><DD><DL><DD>
 the element index
</DL></DL>
<PRE>    integer, intent(in) :: ibin
</PRE>
<DL><DD><DL><DD>
 the bin index
</DL></DL>
<PRE>    real (kind=f), intent(out), dimension (cstate%f_NZ) :: mmr
</PRE>
<DL><DD><DL><DD>
 the bin mass mixing ratio [kg/kg]
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code negative indicates failure
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: nmr
</PRE>
<DL><DD><DL><DD>
 number mixing ratio [#/kg]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: numberDensity
</PRE>
<DL><DD><DL><DD>
 number density [#/cm3]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: r_wet
</PRE>
<DL><DD><DL><DD>
 wet particle radius [cm]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: rhop_wet
</PRE>
<DL><DD><DL><DD>
 wet particle density [g/cm3]
</DL></DL>
<PRE>end subroutine CARMASTATE_GetDetrain
</PRE>
 Gets the mass of the detrained condensate for the bins (ibin) for each particle
 element (ielem) in the grid.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_AddElement.html">CARMA_AddElement</A>, module <A HREF="CARMA_AddGroup.html">CARMA_AddGroup</A>, module <A HREF="CARMA_Step.html">CARMA_Step</A>, module <A HREF="CARMASTATE_SetDetrain.html">CARMASTATE_SetDetrain</A>
<A NAME="subroutine_carmastate_getgas"><H3>CARMASTATE_GetGas</H3></A>
<PRE>public subroutine CARMASTATE_GetGas (cstate, igas, mmr, rc, satice, satliq, eqice, eqliq, wtpct)
    type (carmastate_type), intent(in) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    integer, intent(in) :: igas
</PRE>
<DL><DD><DL><DD>
 the gas index
</DL></DL>
<PRE>    real (kind=f), intent(out), dimension (cstate%f_NZ) :: mmr
</PRE>
<DL><DD><DL><DD>
 the gas mass mixing ratio [kg/kg]
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code, negative indicates failure
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: satice
</PRE>
<DL><DD><DL><DD>
 the gas saturation wrt ice
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: satliq
</PRE>
<DL><DD><DL><DD>
 the gas saturation wrt liquid
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: eqice
</PRE>
<DL><DD><DL><DD>
 the gas vapor pressure wrt ice
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: eqliq
</PRE>
<DL><DD><DL><DD>
 the gas vapor pressure wrt liquid
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: wtpct
</PRE>
<DL><DD><DL><DD>
 weight percent aerosol composition
</DL></DL>
<PRE>end subroutine CARMASTATE_GetGas
</PRE>
 Gets the mass mixing ratio for the gas (igas). After a call to CARMA_Step(),
 the new mass mixing ratio of the gas can be retrieved.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_AddGas.html">CARMA_AddGas</A>, module <A HREF="CARMA_GetGas.html">CARMA_GetGas</A>, module <A HREF="CARMA_Step.html">CARMA_Step</A>, module <A HREF="CARMASTATE_SetGas.html">CARMASTATE_SetGas</A>
<A NAME="subroutine_carmastate_getstate"><H3>CARMASTATE_GetState</H3></A>
<PRE>public subroutine CARMASTATE_GetState (cstate, rc, t, p, rhoa_wet, rlheat)
    type (carmastate_type), intent(in) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code, negative indicates failure
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: t
</PRE>
<DL><DD><DL><DD>
 the air temperature [K]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: p
</PRE>
<DL><DD><DL><DD>
 the air pressure [Pa]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: rhoa_wet
</PRE>
<DL><DD><DL><DD>
 air density [kg m-3]
</DL></DL>
<PRE>    real (kind=f), optional, intent(out), dimension (cstate%f_NZ) :: rlheat
</PRE>
<DL><DD><DL><DD>
 latent heat [K/s]
</DL></DL>
<PRE>end subroutine CARMASTATE_GetState
</PRE>
 Gets information about the state of the atmosphere. After the CARMA_Step() call,
 a new atmospheric state is determined.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_Step.html">CARMA_Step</A>, module <A HREF="CARMASTATE_Create.html">CARMASTATE_Create</A>
<A NAME="subroutine_carmastate_setbin"><H3>CARMASTATE_SetBin</H3></A>
<PRE>public subroutine CARMASTATE_SetBin (cstate, ielem, ibin, mmr, rc, surface)
    type (carmastate_type), intent(inout) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    integer, intent(in) :: ielem
</PRE>
<DL><DD><DL><DD>
 the element index
</DL></DL>
<PRE>    integer, intent(in) :: ibin
</PRE>
<DL><DD><DL><DD>
 the bin index
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (cstate%f_NZ) :: mmr
</PRE>
<DL><DD><DL><DD>
 the bin mass mixing ratio [kg/kg]
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code, negative indicates failure
</DL></DL>
<PRE>    real (kind=f), optional, intent(in) :: surface
</PRE>
<DL><DD><DL><DD>
 particles mass on the surface [kg/m2]
</DL></DL>
<PRE>end subroutine CARMASTATE_SetBin
</PRE>
 Sets the mass of the bins (ibin) for each particle element (ielem) in the grid.
 This call should be made after CARMASTATE_Create() and before CARMA_Step().
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_AddBin.html">CARMA_AddBin</A>, module <A HREF="CARMA_Step.html">CARMA_Step</A>, module <A HREF="CARMASTATE_GetBin.html">CARMASTATE_GetBin</A>
<A NAME="subroutine_carmastate_setdetrain"><H3>CARMASTATE_SetDetrain</H3></A>
<PRE>public subroutine CARMASTATE_SetDetrain (cstate, ielem, ibin, mmr, rc)
    type (carmastate_type), intent(inout) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    integer, intent(in) :: ielem
</PRE>
<DL><DD><DL><DD>
 the element index
</DL></DL>
<PRE>    integer, intent(in) :: ibin
</PRE>
<DL><DD><DL><DD>
 the bin index
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (cstate%f_NZ) :: mmr
</PRE>
<DL><DD><DL><DD>
 the bin mass mixing ratio [kg/kg]
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code, negative indicates failure
</DL></DL>
<PRE>end subroutine CARMASTATE_SetDetrain
</PRE>
 Sets the mass of the detrained condensate for the bins (ibin) for each particle
 element (ielem) in the grid. This call should be made after CARMASTATE_Create()
 and before CARMA_Step().
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> May-2010
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_AddBin.html">CARMA_AddBin</A>, module <A HREF="CARMA_Step.html">CARMA_Step</A>, module <A HREF="CARMASTATE_GetDetrain.html">CARMASTATE_GetDetrain</A>
<A NAME="subroutine_carmastate_setgas"><H3>CARMASTATE_SetGas</H3></A>
<PRE>public subroutine CARMASTATE_SetGas (cstate, igas, mmr, rc, mmr_old, satice_old, satliq_old)
    type (carmastate_type), intent(inout) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma object
</DL></DL>
<PRE>    integer, intent(in) :: igas
</PRE>
<DL><DD><DL><DD>
 the gas index
</DL></DL>
<PRE>    real (kind=f), intent(in), dimension (cstate%f_NZ) :: mmr
</PRE>
<DL><DD><DL><DD>
 the gas mass mixing ratio [kg/kg]
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code, negative indicates failure
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (cstate%f_NZ) :: mmr_old
</PRE>
<DL><DD><DL><DD>
 the previous gas mass mixing ratio [kg/kg]
</DL></DL>
<PRE>    real (kind=f), optional, intent(inout), dimension (cstate%f_NZ) :: satice_old
</PRE>
<DL><DD><DL><DD>
 the previous gas saturation wrt ice, calculates if -1
</DL></DL>
<PRE>    real (kind=f), optional, intent(inout), dimension (cstate%f_NZ) :: satliq_old
</PRE>
<DL><DD><DL><DD>
 the previous gas saturation wrt liquid, calculates if -1
</DL></DL>
<PRE>    ! Calls: <A HREF="supersat.html">supersat</A>
end subroutine CARMASTATE_SetGas
</PRE>
 Sets the mass of the gas (igas) in the grid. This call should be made after
 CARMASTATE_Create() and before CARMA_Step().
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_AddGas.html">CARMA_AddGas</A>, module <A HREF="CARMA_GetGas.html">CARMA_GetGas</A>, module <A HREF="CARMA_InitializeStep.html">CARMA_InitializeStep</A>, module <A HREF="CARMA_Step.html">CARMA_Step</A>
<A NAME="subroutine_carmastate_setstate"><H3>CARMASTATE_SetState</H3></A>
<PRE>public subroutine CARMASTATE_SetState (cstate, rc, t, rhoa_wet)
    type (carmastate_type), intent(inout) :: cstate
</PRE>
<DL><DD><DL><DD>
 the carma state object
</DL></DL>
<PRE>    integer, intent(out) :: rc
</PRE>
<DL><DD><DL><DD>
 return code, negative indicates failure
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (cstate%f_NZ) :: t
</PRE>
<DL><DD><DL><DD>
 the air temperature [K]
</DL></DL>
<PRE>    real (kind=f), optional, intent(in), dimension (cstate%f_NZ) :: rhoa_wet
</PRE>
<DL><DD><DL><DD>
 air density [kg m-3]
</DL></DL>
<PRE>end subroutine CARMASTATE_SetState
</PRE>
 Sets information about the state of the atmosphere.
<P>
<STRONG>Author:</STRONG> Chuck Bardeen
<P>
<STRONG>Version:</STRONG> Feb-2009
<P>
<STRONG>See also:</STRONG> module <A HREF="CARMA_Step.html">CARMA_Step</A>, module <A HREF="CARMASTATE_Create.html">CARMASTATE_Create</A>
</HTML>
