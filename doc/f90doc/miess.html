<HTML>
<HEAD>
   <TITLE> subroutine miess (generated by f90doc) </TITLE>
</HEAD>
<H1> Subroutine miess </H1>
<PRE>subroutine miess

        ! Uses
    use <A HREF="carma_precision_mod.html">carma_precision_mod</A>
    use <A HREF="carma_constants_mod.html">carma_constants_mod</A>, only : IT, DEG2RAD
    use <A HREF="carma_enums_mod.html">carma_enums_mod</A>, only     : RC_ERROR
    use <A HREF="carma_types_mod.html">carma_types_mod</A>, only     : carma_type
    use <A HREF="carma_mod.html">carma_mod</A>

        ! Variables
    type (carma_type), intent(in) :: <A HREF="miess.html#var_carma">carma</A>
    real (kind=f), intent(in) :: <A HREF="miess.html#var_ro">RO</A>
    real (kind=f), intent(in) :: <A HREF="miess.html#var_rfr">RFR</A>
    real (kind=f), intent(in) :: <A HREF="miess.html#var_rfi">RFI</A>
    real (kind=f), intent(in) :: <A HREF="miess.html#var_r">R</A>
    real (kind=f), intent(in) :: <A HREF="miess.html#var_re2">RE2</A>
    real (kind=f), intent(in) :: <A HREF="miess.html#var_tmag2">TMAG2</A>
    real (kind=f), intent(inout), dimension (IT) :: <A HREF="miess.html#var_thetd">THETD</A>
    integer, intent(in) :: <A HREF="miess.html#var_jx">JX</A>
    real (kind=f), intent(out) :: <A HREF="miess.html#var_qext">QEXT</A>
    real (kind=f), intent(out) :: <A HREF="miess.html#var_qscat">QSCAT</A>
    real (kind=f), intent(out) :: <A HREF="miess.html#var_qbs">QBS</A>
    real (kind=f), intent(out) :: <A HREF="miess.html#var_ctbrqs">CTBRQS</A>
    real (kind=f), intent(in) :: <A HREF="miess.html#var_wvno">WVNO</A>
    integer, intent(inout) :: <A HREF="miess.html#var_rc">rc</A>
    real (kind=f), parameter :: <A HREF="miess.html#var_epsilon_mie">EPSILON_MIE</A> = 1.e-14_f
    integer :: <A HREF="miess.html#var_i">I</A>
    integer :: <A HREF="miess.html#var_j">J</A>
    integer :: <A HREF="miess.html#var_k">K</A>
    integer :: <A HREF="miess.html#var_m">M</A>
    integer :: <A HREF="miess.html#var_n">N</A>
    integer :: <A HREF="miess.html#var_nn">NN</A>
    integer :: <A HREF="miess.html#var_nmx1">NMX1</A>
    integer :: <A HREF="miess.html#var_nmx2">NMX2</A>
    integer :: <A HREF="miess.html#var_iflag">IFLAG</A>
    integer :: <A HREF="miess.html#var_iacap">IACAP</A>
    complex (kind=f) :: <A HREF="miess.html#var_fnap">FNAP</A>
    complex (kind=f) :: <A HREF="miess.html#var_fnbp">FNBP</A>
    complex (kind=f) :: <A HREF="miess.html#var_fna">FNA</A>
    complex (kind=f) :: <A HREF="miess.html#var_fnb">FNB</A>
    complex (kind=f) :: <A HREF="miess.html#var_rf">RF</A>
    complex (kind=f) :: <A HREF="miess.html#var_rrf">RRF</A>
    complex (kind=f) :: <A HREF="miess.html#var_rrfx">RRFX</A>
    complex (kind=f) :: <A HREF="miess.html#var_wm1">WM1</A>
    complex (kind=f) :: <A HREF="miess.html#var_fn1">FN1</A>
    complex (kind=f) :: <A HREF="miess.html#var_fn2">FN2</A>
    complex (kind=f) :: <A HREF="miess.html#var_tc1">TC1</A>
    complex (kind=f) :: <A HREF="miess.html#var_tc2">TC2</A>
    complex (kind=f), dimension (2) :: <A HREF="miess.html#var_wfn">WFN</A>
    complex (kind=f), dimension (4) :: <A HREF="miess.html#var_z">Z</A>
    complex (kind=f) :: <A HREF="miess.html#var_k1">K1</A>
    complex (kind=f) :: <A HREF="miess.html#var_k2">K2</A>
    complex (kind=f) :: <A HREF="miess.html#var_k3">K3</A>
    complex (kind=f) :: <A HREF="miess.html#var_rcr">RCR</A>
    complex (kind=f), dimension (8) :: <A HREF="miess.html#var_u">U</A>
    complex (kind=f) :: <A HREF="miess.html#var_dh1">DH1</A>
    complex (kind=f) :: <A HREF="miess.html#var_dh2">DH2</A>
    complex (kind=f) :: <A HREF="miess.html#var_dh4">DH4</A>
    complex (kind=f) :: <A HREF="miess.html#var_p24h24">P24H24</A>
    complex (kind=f) :: <A HREF="miess.html#var_p24h21">P24H21</A>
    complex (kind=f) :: <A HREF="miess.html#var_pstore">PSTORE</A>
    complex (kind=f) :: <A HREF="miess.html#var_hstore">HSTORE</A>
    complex (kind=f) :: <A HREF="miess.html#var_dummy">DUMMY</A>
    complex (kind=f) :: <A HREF="miess.html#var_dumsq">DUMSQ</A>
    complex (kind=f), allocatable, dimension (:) :: <A HREF="miess.html#var_acap">ACAP</A>
    complex (kind=f), allocatable, dimension (:,:) :: <A HREF="miess.html#var_w">W</A>
    real (kind=f), dimension (5) :: <A HREF="miess.html#var_t">T</A>
    real (kind=f), dimension (4) :: <A HREF="miess.html#var_ta">TA</A>
    real (kind=f), dimension (3,IT) :: <A HREF="miess.html#var_pi">PI</A>
    real (kind=f), dimension (3,IT) :: <A HREF="miess.html#var_tau">TAU</A>
    real (kind=f), dimension (IT) :: <A HREF="miess.html#var_cstht">CSTHT</A>
    real (kind=f), dimension (IT) :: <A HREF="miess.html#var_si2tht">SI2THT</A>
    real (kind=f) :: <A HREF="miess.html#var_x">X</A>
    real (kind=f) :: <A HREF="miess.html#var_x1">X1</A>
    real (kind=f) :: <A HREF="miess.html#var_x4">X4</A>
    real (kind=f) :: <A HREF="miess.html#var_y1">Y1</A>
    real (kind=f) :: <A HREF="miess.html#var_y4">Y4</A>
    real (kind=f) :: <A HREF="miess.html#var_rx">RX</A>
    real (kind=f) :: <A HREF="miess.html#var_sinx1">SINX1</A>
    real (kind=f) :: <A HREF="miess.html#var_sinx4">SINX4</A>
    real (kind=f) :: <A HREF="miess.html#var_cosx1">COSX1</A>
    real (kind=f) :: <A HREF="miess.html#var_cosx4">COSX4</A>
    real (kind=f) :: <A HREF="miess.html#var_ey1">EY1</A>
    real (kind=f) :: <A HREF="miess.html#var_e2y1">E2Y1</A>
    real (kind=f) :: <A HREF="miess.html#var_ey4">EY4</A>
    real (kind=f) :: <A HREF="miess.html#var_ey1my4">EY1MY4</A>
    real (kind=f) :: <A HREF="miess.html#var_ey1py4">EY1PY4</A>
    real (kind=f) :: <A HREF="miess.html#var_aa">AA</A>
    real (kind=f) :: <A HREF="miess.html#var_bb">BB</A>
    real (kind=f) :: <A HREF="miess.html#var_cc">CC</A>
    real (kind=f) :: <A HREF="miess.html#var_dd">DD</A>
    real (kind=f) :: <A HREF="miess.html#var_denom">DENOM</A>
    real (kind=f) :: <A HREF="miess.html#var_realp">REALP</A>
    real (kind=f) :: <A HREF="miess.html#var_amagp">AMAGP</A>
    real (kind=f) :: <A HREF="miess.html#var_qbsr">QBSR</A>
    real (kind=f) :: <A HREF="miess.html#var_qbsi">QBSI</A>
    real (kind=f) :: <A HREF="miess.html#var_rmm">RMM</A>
    real (kind=f) :: <A HREF="miess.html#var_pig">PIG</A>
    real (kind=f) :: <A HREF="miess.html#var_rxp4">RXP4</A>
    real (kind=f), dimension (4,IT,2) :: <A HREF="miess.html#var_eltrmx">ELTRMX</A>

end subroutine miess
</PRE>
 This subroutine computes mie scattering by a stratified sphere,
 i.e. a particle consisting of a spherical core surrounded by a
 Spherical shell.  The basic code used was that described in the
 report: " Subroutines for computing the parameters of the
 electromagnetic radiation scattered by a sphere " J.V. Dave,
 IBM Scientific Center, Palo Alto , California.
 Report No. 320 - 3236 .. May 1968 .
<P>
 The modifications for stratified spheres are described in
   Toon and Ackerman, Appl. Optics, in press, 1981
<P>
 The definitions for the output parameters can be found in "Light
 scattering by small particles, H.C.Van de Hulst, John Wiley '
 Sons, Inc., New York, 1957".
<P>
 Also the subroutine computes the capital A function by making use of
 downward recurrence relationship.
<P>
<STRONG>Author:</STRONG> Brian Toon
<P>
<STRONG>Version:</STRONG> 1981?

<HR><H2> Description of Variables </H2>
<A NAME="var_carma"><H3>carma</H3></A>
<PRE>type (carma_type), intent(in) :: carma
</PRE>
 the carma object
<A NAME="var_ro"><H3>RO</H3></A>
<PRE>real (kind=f), intent(in) :: RO
</PRE>
 OUTER (SHELL) RADIUS
<A NAME="var_rfr"><H3>RFR</H3></A>
<PRE>real (kind=f), intent(in) :: RFR
</PRE>
 REAL PART OF THE SHELL INDEX OF REFRACTION
<A NAME="var_rfi"><H3>RFI</H3></A>
<PRE>real (kind=f), intent(in) :: RFI
</PRE>
 IMAGINARY PART OF THE SHELL INDEX OF REFRACTION
<A NAME="var_r"><H3>R</H3></A>
<PRE>real (kind=f), intent(in) :: R
</PRE>
 CORE RADIUS
<A NAME="var_re2"><H3>RE2</H3></A>
<PRE>real (kind=f), intent(in) :: RE2
</PRE>
 REAL PART OF THE CORE INDEX OF REFRACTION
<A NAME="var_tmag2"><H3>TMAG2</H3></A>
<PRE>real (kind=f), intent(in) :: TMAG2
</PRE>
 IMAGINARY PART OF THE CORE INDEX OF REFRACTION
<A NAME="var_thetd"><H3>THETD</H3></A>
<PRE>real (kind=f), intent(inout), dimension (IT) :: THETD
</PRE>
 ANGLE IN DEGREES BETWEEN THE DIRECTIONS OF THE INCIDENT
 AND THE SCATTERED RADIATION.  THETD(J) IS< OR= 90.0
 IF THETD(J) SHOULD HAPPEN TO BE GREATER THAN 90.0, ENTER WITH
 SUPPLEMENTARY VALUE, SEE COMMENTS ON ELTRMX.
<A NAME="var_jx"><H3>JX</H3></A>
<PRE>integer, intent(in) :: JX
</PRE>
 TOTAL NUMBER OF THETD FOR WHICH THE COMPUTATIONS ARE
 REQUIRED.  JX SHOULD NOT EXCEED IT UNLESS THE DIMENSIONS
 STATEMENTS ARE APPROPRIATEDLY MODIFIED.
<A NAME="var_qext"><H3>QEXT</H3></A>
<PRE>real (kind=f), intent(out) :: QEXT
</PRE>
 EFFICIENCY FACTOR FOR EXTINCTION,VAN DE HULST,P.14 ' 127.
<A NAME="var_qscat"><H3>QSCAT</H3></A>
<PRE>real (kind=f), intent(out) :: QSCAT
</PRE>
 EFFICIENCY FACTOR FOR SCATTERING,V.D. HULST,P.14 ' 127.
<A NAME="var_qbs"><H3>QBS</H3></A>
<PRE>real (kind=f), intent(out) :: QBS
</PRE>
 BACK SCATTER CROSS SECTION.
<A NAME="var_ctbrqs"><H3>CTBRQS</H3></A>
<PRE>real (kind=f), intent(out) :: CTBRQS
</PRE>
 AVERAGE(COSINE THETA) * QSCAT,VAN DE HULST,P.128.
<A NAME="var_wvno"><H3>WVNO</H3></A>
<PRE>real (kind=f), intent(in) :: WVNO
</PRE>
 2*PI / WAVELENGTH.
<A NAME="var_rc"><H3>rc</H3></A>
<PRE>integer, intent(inout) :: rc
</PRE>
 return code, negative indicates failure
<A NAME="var_epsilon_mie"><H3>EPSILON_MIE</H3></A>
<PRE>real (kind=f), parameter :: EPSILON_MIE = 1.e-14_f
</PRE>
<A NAME="var_i"><H3>I</H3></A>
<PRE>integer :: I
</PRE>
<A NAME="var_j"><H3>J</H3></A>
<PRE>integer :: J
</PRE>
<A NAME="var_k"><H3>K</H3></A>
<PRE>integer :: K
</PRE>
<A NAME="var_m"><H3>M</H3></A>
<PRE>integer :: M
</PRE>
<A NAME="var_n"><H3>N</H3></A>
<PRE>integer :: N
</PRE>
<A NAME="var_nn"><H3>NN</H3></A>
<PRE>integer :: NN
</PRE>
<A NAME="var_nmx1"><H3>NMX1</H3></A>
<PRE>integer :: NMX1
</PRE>
<A NAME="var_nmx2"><H3>NMX2</H3></A>
<PRE>integer :: NMX2
</PRE>
<A NAME="var_iflag"><H3>IFLAG</H3></A>
<PRE>integer :: IFLAG
</PRE>
<A NAME="var_iacap"><H3>IACAP</H3></A>
<PRE>integer :: IACAP
</PRE>
<A NAME="var_fnap"><H3>FNAP</H3></A>
<PRE>complex (kind=f) :: FNAP
</PRE>
<A NAME="var_fnbp"><H3>FNBP</H3></A>
<PRE>complex (kind=f) :: FNBP
</PRE>
<A NAME="var_fna"><H3>FNA</H3></A>
<PRE>complex (kind=f) :: FNA
</PRE>
<A NAME="var_fnb"><H3>FNB</H3></A>
<PRE>complex (kind=f) :: FNB
</PRE>
<A NAME="var_rf"><H3>RF</H3></A>
<PRE>complex (kind=f) :: RF
</PRE>
<A NAME="var_rrf"><H3>RRF</H3></A>
<PRE>complex (kind=f) :: RRF
</PRE>
<A NAME="var_rrfx"><H3>RRFX</H3></A>
<PRE>complex (kind=f) :: RRFX
</PRE>
<A NAME="var_wm1"><H3>WM1</H3></A>
<PRE>complex (kind=f) :: WM1
</PRE>
<A NAME="var_fn1"><H3>FN1</H3></A>
<PRE>complex (kind=f) :: FN1
</PRE>
<A NAME="var_fn2"><H3>FN2</H3></A>
<PRE>complex (kind=f) :: FN2
</PRE>
<A NAME="var_tc1"><H3>TC1</H3></A>
<PRE>complex (kind=f) :: TC1
</PRE>
<A NAME="var_tc2"><H3>TC2</H3></A>
<PRE>complex (kind=f) :: TC2
</PRE>
<A NAME="var_wfn"><H3>WFN</H3></A>
<PRE>complex (kind=f), dimension (2) :: WFN
</PRE>
<A NAME="var_z"><H3>Z</H3></A>
<PRE>complex (kind=f), dimension (4) :: Z
</PRE>
<A NAME="var_k1"><H3>K1</H3></A>
<PRE>complex (kind=f) :: K1
</PRE>
<A NAME="var_k2"><H3>K2</H3></A>
<PRE>complex (kind=f) :: K2
</PRE>
<A NAME="var_k3"><H3>K3</H3></A>
<PRE>complex (kind=f) :: K3
</PRE>
<A NAME="var_rcr"><H3>RCR</H3></A>
<PRE>complex (kind=f) :: RCR
</PRE>
<A NAME="var_u"><H3>U</H3></A>
<PRE>complex (kind=f), dimension (8) :: U
</PRE>
<A NAME="var_dh1"><H3>DH1</H3></A>
<PRE>complex (kind=f) :: DH1
</PRE>
<A NAME="var_dh2"><H3>DH2</H3></A>
<PRE>complex (kind=f) :: DH2
</PRE>
<A NAME="var_dh4"><H3>DH4</H3></A>
<PRE>complex (kind=f) :: DH4
</PRE>
<A NAME="var_p24h24"><H3>P24H24</H3></A>
<PRE>complex (kind=f) :: P24H24
</PRE>
<A NAME="var_p24h21"><H3>P24H21</H3></A>
<PRE>complex (kind=f) :: P24H21
</PRE>
<A NAME="var_pstore"><H3>PSTORE</H3></A>
<PRE>complex (kind=f) :: PSTORE
</PRE>
<A NAME="var_hstore"><H3>HSTORE</H3></A>
<PRE>complex (kind=f) :: HSTORE
</PRE>
<A NAME="var_dummy"><H3>DUMMY</H3></A>
<PRE>complex (kind=f) :: DUMMY
</PRE>
<A NAME="var_dumsq"><H3>DUMSQ</H3></A>
<PRE>complex (kind=f) :: DUMSQ
</PRE>
<A NAME="var_acap"><H3>ACAP</H3></A>
<PRE>complex (kind=f), allocatable, dimension (:) :: ACAP
</PRE>
<A NAME="var_w"><H3>W</H3></A>
<PRE>complex (kind=f), allocatable, dimension (:,:) :: W
</PRE>
<A NAME="var_t"><H3>T</H3></A>
<PRE>real (kind=f), dimension (5) :: T
</PRE>
<A NAME="var_ta"><H3>TA</H3></A>
<PRE>real (kind=f), dimension (4) :: TA
</PRE>
<A NAME="var_pi"><H3>PI</H3></A>
<PRE>real (kind=f), dimension (3,IT) :: PI
</PRE>
<A NAME="var_tau"><H3>TAU</H3></A>
<PRE>real (kind=f), dimension (3,IT) :: TAU
</PRE>
<A NAME="var_cstht"><H3>CSTHT</H3></A>
<PRE>real (kind=f), dimension (IT) :: CSTHT
</PRE>
<A NAME="var_si2tht"><H3>SI2THT</H3></A>
<PRE>real (kind=f), dimension (IT) :: SI2THT
</PRE>
<A NAME="var_x"><H3>X</H3></A>
<PRE>real (kind=f) :: X
</PRE>
<A NAME="var_x1"><H3>X1</H3></A>
<PRE>real (kind=f) :: X1
</PRE>
<A NAME="var_x4"><H3>X4</H3></A>
<PRE>real (kind=f) :: X4
</PRE>
<A NAME="var_y1"><H3>Y1</H3></A>
<PRE>real (kind=f) :: Y1
</PRE>
<A NAME="var_y4"><H3>Y4</H3></A>
<PRE>real (kind=f) :: Y4
</PRE>
<A NAME="var_rx"><H3>RX</H3></A>
<PRE>real (kind=f) :: RX
</PRE>
<A NAME="var_sinx1"><H3>SINX1</H3></A>
<PRE>real (kind=f) :: SINX1
</PRE>
<A NAME="var_sinx4"><H3>SINX4</H3></A>
<PRE>real (kind=f) :: SINX4
</PRE>
<A NAME="var_cosx1"><H3>COSX1</H3></A>
<PRE>real (kind=f) :: COSX1
</PRE>
<A NAME="var_cosx4"><H3>COSX4</H3></A>
<PRE>real (kind=f) :: COSX4
</PRE>
<A NAME="var_ey1"><H3>EY1</H3></A>
<PRE>real (kind=f) :: EY1
</PRE>
<A NAME="var_e2y1"><H3>E2Y1</H3></A>
<PRE>real (kind=f) :: E2Y1
</PRE>
<A NAME="var_ey4"><H3>EY4</H3></A>
<PRE>real (kind=f) :: EY4
</PRE>
<A NAME="var_ey1my4"><H3>EY1MY4</H3></A>
<PRE>real (kind=f) :: EY1MY4
</PRE>
<A NAME="var_ey1py4"><H3>EY1PY4</H3></A>
<PRE>real (kind=f) :: EY1PY4
</PRE>
<A NAME="var_aa"><H3>AA</H3></A>
<PRE>real (kind=f) :: AA
</PRE>
<A NAME="var_bb"><H3>BB</H3></A>
<PRE>real (kind=f) :: BB
</PRE>
<A NAME="var_cc"><H3>CC</H3></A>
<PRE>real (kind=f) :: CC
</PRE>
<A NAME="var_dd"><H3>DD</H3></A>
<PRE>real (kind=f) :: DD
</PRE>
<A NAME="var_denom"><H3>DENOM</H3></A>
<PRE>real (kind=f) :: DENOM
</PRE>
<A NAME="var_realp"><H3>REALP</H3></A>
<PRE>real (kind=f) :: REALP
</PRE>
<A NAME="var_amagp"><H3>AMAGP</H3></A>
<PRE>real (kind=f) :: AMAGP
</PRE>
<A NAME="var_qbsr"><H3>QBSR</H3></A>
<PRE>real (kind=f) :: QBSR
</PRE>
<A NAME="var_qbsi"><H3>QBSI</H3></A>
<PRE>real (kind=f) :: QBSI
</PRE>
<A NAME="var_rmm"><H3>RMM</H3></A>
<PRE>real (kind=f) :: RMM
</PRE>
<A NAME="var_pig"><H3>PIG</H3></A>
<PRE>real (kind=f) :: PIG
</PRE>
<A NAME="var_rxp4"><H3>RXP4</H3></A>
<PRE>real (kind=f) :: RXP4
</PRE>
<A NAME="var_eltrmx"><H3>ELTRMX</H3></A>
<PRE>real (kind=f), dimension (4,IT,2) :: ELTRMX
</PRE>
 ELTRMX(I,J,K): ELEMENTS OF THE TRANSFORMATION MATRIX F,V.D.HULST,P.34,45 ' 125.
   I=1: ELEMENT M SUB 2..I=2: ELEMENT M SUB 1..
   I = 3: ELEMENT S SUB 21.. I = 4: ELEMENT D SUB 21..
 ELTRMX(I,J,1) REPRESENTS THE ITH ELEMENT OF THE MATRIX FOR
   THE ANGLE THETD(J).. ELTRMX(I,J,2) REPRESENTS THE ITH ELEMENT
   OF THE MATRIX FOR THE ANGLE 180.0 - THETD(J) ..
</HTML>
