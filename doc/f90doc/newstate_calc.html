<HTML>
<HEAD>
   <TITLE> subroutine newstate_calc (generated by f90doc) </TITLE>
</HEAD>
<H1> Subroutine newstate_calc </H1>
<PRE>subroutine newstate_calc

        ! Uses
    use <A HREF="carma_precision_mod.html">carma_precision_mod</A>
    use <A HREF="carma_enums_mod.html">carma_enums_mod</A>
    use <A HREF="carma_constants_mod.html">carma_constants_mod</A>
    use <A HREF="carma_types_mod.html">carma_types_mod</A>
    use <A HREF="carmastate_mod.html">carmastate_mod</A>
    use <A HREF="carma_mod.html">carma_mod</A>

        ! Calls
    call <A HREF="coremasscheck.html">coremasscheck</A>
    call <A HREF="fixcorecol.html">fixcorecol</A>
    call <A HREF="maxconc.html">maxconc</A>
    call <A HREF="microfast.html">microfast</A>
    call <A HREF="microslow.html">microslow</A>
    call <A HREF="nsubsteps.html">nsubsteps</A>
    call <A HREF="supersat.html">supersat</A>

        ! Variables
    type (carma_type), intent(in) :: <A HREF="newstate_calc.html#var_carma">carma</A>
    type (carmastate_type), intent(inout) :: <A HREF="newstate_calc.html#var_cstate">cstate</A>
    real (kind=f), intent(in), dimension (NZ) :: <A HREF="newstate_calc.html#var_scale_threshold">scale_threshold</A>
    integer, intent(inout) :: <A HREF="newstate_calc.html#var_rc">rc</A>
    real (kind=f), dimension (NBIN,NELEM) :: <A HREF="newstate_calc.html#var_sedlayer">sedlayer</A>
    real (kind=f), dimension (NBIN,NELEM) :: <A HREF="newstate_calc.html#var_pcd_last">pcd_last</A>
    integer :: <A HREF="newstate_calc.html#var_kb">kb</A>
    integer :: <A HREF="newstate_calc.html#var_ke">ke</A>
    integer :: <A HREF="newstate_calc.html#var_idk">idk</A>
    integer :: <A HREF="newstate_calc.html#var_iz">iz</A>
    integer :: <A HREF="newstate_calc.html#var_isubstep">isubstep</A>
    integer :: <A HREF="newstate_calc.html#var_igroup">igroup</A>
    integer :: <A HREF="newstate_calc.html#var_igas">igas</A>
    integer :: <A HREF="newstate_calc.html#var_ielem">ielem</A>
    integer :: <A HREF="newstate_calc.html#var_ibin">ibin</A>
    integer :: <A HREF="newstate_calc.html#var_ntsubsteps">ntsubsteps</A>
    logical :: <A HREF="newstate_calc.html#var_takesteps">takeSteps</A>
    real (kind=f) :: <A HREF="newstate_calc.html#var_fraction">fraction</A>

end subroutine newstate_calc
</PRE>
 This routine manages the calculations that update state variables
 of the model with new values at the current simulation time. It supports
 a retry mechanism, so the the number of steps can be increased dynamically
 if the fast microphysics was not able to generate a valid solution. The
 validity of the solution is control by the convergence thresholds
 (dgc_threshold, dt_threshold and ds_threshold)
<P>
 NOTE: For cloud models, this routine may get called multiple times, once for
 in-cloud calculations and again for clear sky.
<P>
<STRONG>Author:</STRONG> Bardeen
<P>
<STRONG>Version:</STRONG> Jan 2012

<HR><H2> Description of Variables </H2>
<A NAME="var_carma"><H3>carma</H3></A>
<PRE>type (carma_type), intent(in) :: carma
</PRE>
 the carma object
<A NAME="var_cstate"><H3>cstate</H3></A>
<PRE>type (carmastate_type), intent(inout) :: cstate
</PRE>
 the carma state object
<A NAME="var_scale_threshold"><H3>scale_threshold</H3></A>
<PRE>real (kind=f), intent(in), dimension (NZ) :: scale_threshold
</PRE>
 Scaling factor for convergence thresholds
<A NAME="var_rc"><H3>rc</H3></A>
<PRE>integer, intent(inout) :: rc
</PRE>
 return code, negative indicates failure
<A NAME="var_sedlayer"><H3>sedlayer</H3></A>
<PRE>real (kind=f), dimension (NBIN,NELEM) :: sedlayer
</PRE>
<A NAME="var_pcd_last"><H3>pcd_last</H3></A>
<PRE>real (kind=f), dimension (NBIN,NELEM) :: pcd_last
</PRE>
<A NAME="var_kb"><H3>kb</H3></A>
<PRE>integer :: kb
</PRE>
<A NAME="var_ke"><H3>ke</H3></A>
<PRE>integer :: ke
</PRE>
<A NAME="var_idk"><H3>idk</H3></A>
<PRE>integer :: idk
</PRE>
<A NAME="var_iz"><H3>iz</H3></A>
<PRE>integer :: iz
</PRE>
<A NAME="var_isubstep"><H3>isubstep</H3></A>
<PRE>integer :: isubstep
</PRE>
<A NAME="var_igroup"><H3>igroup</H3></A>
<PRE>integer :: igroup
</PRE>
<A NAME="var_igas"><H3>igas</H3></A>
<PRE>integer :: igas
</PRE>
<A NAME="var_ielem"><H3>ielem</H3></A>
<PRE>integer :: ielem
</PRE>
<A NAME="var_ibin"><H3>ibin</H3></A>
<PRE>integer :: ibin
</PRE>
<A NAME="var_ntsubsteps"><H3>ntsubsteps</H3></A>
<PRE>integer :: ntsubsteps
</PRE>
<A NAME="var_takesteps"><H3>takeSteps</H3></A>
<PRE>logical :: takeSteps
</PRE>
<A NAME="var_fraction"><H3>fraction</H3></A>
<PRE>real (kind=f) :: fraction
</PRE>
</HTML>
